<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />
        <link rel="canonical" href="https://genieclust.gagolewski.com/weave/sparse.html" />

    <link rel="shortcut icon" href="../_static/favicon.png"/><!-- Generated with Sphinx 7.2.5 and Furo 2023.08.19 -->
        <title>Example: Sparse Data and Movie Recommendation - Python and R Package genieclust</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=b4e99bb3" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 95%;
  --admonition-title-font-size: 95%;
  --color-brand-primary: #ff2b53;
  --color-brand-content: #dd3333;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Python and R Package genieclust</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">

<span class="sidebar-brand-text">
<a class="sidebar-brand" href="../index.html">genieclust</a>
</span>
<div class="sidebar-brand">
1.1.4.9004
</div>
<form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">genieclust</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.gagolewski.com/">Author</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/genieclust">Source Code (GitHub)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/gagolews/genieclust/issues">Bug Tracker and Feature Suggestions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/genieclust/">PyPI Entry</a></li>
<li class="toctree-l1"><a class="reference external" href="https://CRAN.R-project.org/package=genieclust">CRAN Entry</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples and Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="sklearn_toy_example.html">Comparing Algorithms on Toy Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks_ar.html">Benchmarks (How Good Is It?)</a></li>
<li class="toctree-l1"><a class="reference internal" href="timings.html">Timings (How Fast Is It?)</a></li>
<li class="toctree-l1"><a class="reference internal" href="noise.html">Clustering with Noise Points Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="r.html">R Interface Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../genieclust.html">Python Package <cite>genieclust</cite> Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Python Package genieclust Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_genie.html">genieclust.Genie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_gic.html">genieclust.GIc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_cluster_validity.html">genieclust.cluster_validity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_compare_partitions.html">genieclust.compare_partitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_inequality.html">genieclust.inequality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_internal.html">genieclust.internal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_plots.html">genieclust.plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../genieclust_tools.html">genieclust.tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../rapi.html">R Package <em>genieclust</em> Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of R Package genieclust Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../rapi/cluster_validity.html">cluster_validity: Internal Cluster Validity Measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapi/compare_partitions.html">compare_partitions: External Cluster Validity Measures and Pairwise Partition Similarity Scores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapi/emst_mlpack.html">emst_mlpack: Euclidean Minimum Spanning Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapi/gclust.html">gclust: Hierarchical Clustering Algorithm Genie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapi/genieclust-package.html">genieclust-package: The Genie Hierarchical Clustering Algorithm (with Extras)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapi/inequality.html">inequality: Inequality Measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rapi/mst.html">mst: Minimum Spanning Tree of the Pairwise Distance Graph</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">See Also</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://clustering-benchmarks.gagolewski.com">Clustering Benchmarks</a></li>
<li class="toctree-l1"><a class="reference external" href="https://datawranglingpy.gagolewski.com/">Minimalist Data Wrangling in Python</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepr.gagolewski.com">Deep R Programming</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../news.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks_details.html">Benchmarks — Detailed Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks_approx.html">Benchmarks — Approximate Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../z_bibliography.html">References</a></li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/gagolews/genieclust/issues/" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto colour theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="example-sparse-data-and-movie-recommendation">
<h1>Example: Sparse Data and Movie Recommendation<a class="headerlink" href="#example-sparse-data-and-movie-recommendation" title="Link to this heading">#</a></h1>
<p>To illustrate how <em>genieclust</em> handles
<a class="reference external" href="https://en.wikipedia.org/wiki/Sparse_matrix">sparse data</a>,
let’s perform a simple exercise in movie recommendation based on
<a class="reference external" href="https://grouplens.org/datasets/movielens/latest/">MovieLens</a> data.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the <em>nmslib</em> package (an optional dependency) is installed.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>First we load the <cite>ratings</cite> data frame
and map the movie IDs to consecutive integers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;ml-9-2018-small/ratings.csv&quot;</span><span class="p">)</span>
<span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;userId&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">old_movieId_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">])</span>
<span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">old_movieId_map</span><span class="p">,</span> <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">])</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##    userId  movieId  rating  timestamp</span>
<span class="c1">## 0       0        0     4.0  964982703</span>
<span class="c1">## 1       0        2     4.0  964981247</span>
<span class="c1">## 2       0        5     4.0  964982224</span>
<span class="c1">## 3       0       43     5.0  964983815</span>
<span class="c1">## 4       0       46     5.0  964982931</span>
</pre></div>
</div>
<p>Then we read the movie metadata and transform the movie IDs
in the same way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;ml-9-2018-small/movies.csv&quot;</span><span class="p">)</span>
<span class="n">movies</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">movies</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movies</span><span class="o">.</span><span class="n">movieId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">old_movieId_map</span><span class="p">),</span> <span class="p">:]</span>
<span class="n">movies</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">old_movieId_map</span><span class="p">,</span> <span class="n">movies</span><span class="p">[</span><span class="s2">&quot;movieId&quot;</span><span class="p">])</span>
<span class="n">movies</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##    movieId                               title</span>
<span class="c1">## 0        0                    Toy Story (1995)</span>
<span class="c1">## 1        1                      Jumanji (1995)</span>
<span class="c1">## 2        2             Grumpier Old Men (1995)</span>
<span class="c1">## 3        3            Waiting to Exhale (1995)</span>
<span class="c1">## 4        4  Father of the Bride Part II (1995)</span>
</pre></div>
</div>
<p>Conversion of ratings to a CSR-format sparse matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">movieId</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">userId</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">dok_matrix</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">X</span><span class="p">[</span><span class="n">ratings</span><span class="o">.</span><span class="n">movieId</span><span class="p">,</span> <span class="n">ratings</span><span class="o">.</span><span class="n">userId</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">rating</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## &lt;9724x610 sparse matrix of type &#39;&lt;class &#39;numpy.float32&#39;&gt;&#39;</span>
<span class="c1">##         with 100836 stored elements in Compressed Sparse Row format&gt;</span>
</pre></div>
</div>
<p>First few observations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## matrix([[4. , 0. , 0. , 0. , 4. , 0. , 4.5, 0. , 0. , 0. ],</span>
<span class="c1">##         [0. , 0. , 0. , 0. , 0. , 4. , 0. , 4. , 0. , 0. ],</span>
<span class="c1">##         [4. , 0. , 0. , 0. , 0. , 5. , 0. , 0. , 0. , 0. ],</span>
<span class="c1">##         [0. , 0. , 0. , 0. , 0. , 3. , 0. , 0. , 0. , 0. ],</span>
<span class="c1">##         [0. , 0. , 0. , 0. , 0. , 5. , 0. , 0. , 0. , 0. ]],</span>
<span class="c1">## dtype=float32)</span>
</pre></div>
</div>
<p>Let’s extract 200 clusters with Genie with respect to the cosine similarity between films’ ratings
as given by users (two movies considered similar if they get similar reviews).
Sparse inputs are supported by the approximate version of the algorithm
which relies on the near-neighbour search routines implemented in the <em>nmslib</em> package.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">genieclust</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">genieclust</span><span class="o">.</span><span class="n">Genie</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;cosinesimil_sparse&quot;</span><span class="p">)</span>
<span class="n">movies</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## ---------------------------------------------------------------------------ValueError</span>
<span class="c1">## Traceback (most recent call last)Cell In[1], line 3</span>
<span class="c1">##       1 import genieclust</span>
<span class="c1">##       2 g = genieclust.Genie(n_clusters=200, exact=False,</span>
<span class="c1">## affinity=&quot;cosinesimil_sparse&quot;)</span>
<span class="c1">## ----&gt; 3 movies[&quot;cluster&quot;] = g.fit_predict(X)</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:548, in GenieBase.fit_predict(self, X, y)</span>
<span class="c1">##     520 def fit_predict(self, X, y=None):</span>
<span class="c1">##     521     &quot;&quot;&quot;</span>
<span class="c1">##     522     Perform cluster analysis of a dataset and return the</span>
<span class="c1">## predicted labels.</span>
<span class="c1">##     523</span>
<span class="c1">##    (...)</span>
<span class="c1">##     546</span>
<span class="c1">##     547     &quot;&quot;&quot;</span>
<span class="c1">## --&gt; 548     self.fit(X)</span>
<span class="c1">##     549     return self.labels_</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:1051, in Genie.fit(self, X, y)</span>
<span class="c1">##     972 &quot;&quot;&quot;</span>
<span class="c1">##     973 Perform cluster analysis of a dataset.</span>
<span class="c1">##     974</span>
<span class="c1">##    (...)</span>
<span class="c1">##    1047</span>
<span class="c1">##    1048 &quot;&quot;&quot;</span>
<span class="c1">##    1049 cur_state = self._check_params()  # re-check, they might have</span>
<span class="c1">## changed</span>
<span class="c1">## -&gt; 1051 cur_state = self._get_mst(X, cur_state)</span>
<span class="c1">##    1053 if cur_state[&quot;verbose&quot;]:</span>
<span class="c1">##    1054     print(&quot;[genieclust] Determining clusters with Genie++.&quot;,</span>
<span class="c1">## file=sys.stderr)</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:511, in GenieBase._get_mst(self, X,</span>
<span class="c1">## cur_state)</span>
<span class="c1">##     509     cur_state = self._get_mst_exact(X, cur_state)</span>
<span class="c1">##     510 else:</span>
<span class="c1">## --&gt; 511     cur_state = self._get_mst_approx(X, cur_state)</span>
<span class="c1">##     513 # this might be an &quot;intrinsic&quot; dimensionality:</span>
<span class="c1">##     514 self.n_features_  = cur_state[&quot;n_features&quot;]</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:380, in GenieBase._get_mst_approx(self,</span>
<span class="c1">## X, cur_state)</span>
<span class="c1">##     378 def _get_mst_approx(self, X, cur_state):</span>
<span class="c1">##     379     if nmslib is None:</span>
<span class="c1">## --&gt; 380         raise ValueError(&quot;Package `nmslib` is not available.&quot;)</span>
<span class="c1">##     382     if cur_state[&quot;affinity&quot;] == &quot;precomputed&quot;:</span>
<span class="c1">##     383         raise ValueError(</span>
<span class="c1">##     384             &quot;`affinity` of &#39;precomputed&#39; can only be used &quot;</span>
<span class="c1">##     385             &quot;with `exact` = True.&quot;)</span>
<span class="c1">## ValueError: Package `nmslib` is not available.</span>
</pre></div>
</div>
<p>Here are the members of an example cluster:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">movies</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">which_cluster</span> <span class="o">=</span> <span class="n">movies</span><span class="o">.</span><span class="n">cluster</span><span class="p">[</span><span class="n">movies</span><span class="o">.</span><span class="n">title</span><span class="o">==</span><span class="s2">&quot;Monty Python&#39;s The Meaning of Life (1983)&quot;</span><span class="p">]</span>
<span class="n">movies</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movies</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">which_cluster</span><span class="p">)]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## ---------------------------------------------------------------------------ValueError</span>
<span class="c1">## Traceback (most recent call last)Cell In[1], line 1</span>
<span class="c1">## ----&gt; 1 movies[&quot;cluster&quot;] = g.fit_predict(X)</span>
<span class="c1">##       2 which_cluster = movies.cluster[movies.title==&quot;Monty Python&#39;s</span>
<span class="c1">## The Meaning of Life (1983)&quot;]</span>
<span class="c1">##       3 movies.loc[movies.cluster ==</span>
<span class="c1">## int(which_cluster)].title.sort_values()</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:548, in GenieBase.fit_predict(self, X, y)</span>
<span class="c1">##     520 def fit_predict(self, X, y=None):</span>
<span class="c1">##     521     &quot;&quot;&quot;</span>
<span class="c1">##     522     Perform cluster analysis of a dataset and return the</span>
<span class="c1">## predicted labels.</span>
<span class="c1">##     523</span>
<span class="c1">##    (...)</span>
<span class="c1">##     546</span>
<span class="c1">##     547     &quot;&quot;&quot;</span>
<span class="c1">## --&gt; 548     self.fit(X)</span>
<span class="c1">##     549     return self.labels_</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:1051, in Genie.fit(self, X, y)</span>
<span class="c1">##     972 &quot;&quot;&quot;</span>
<span class="c1">##     973 Perform cluster analysis of a dataset.</span>
<span class="c1">##     974</span>
<span class="c1">##    (...)</span>
<span class="c1">##    1047</span>
<span class="c1">##    1048 &quot;&quot;&quot;</span>
<span class="c1">##    1049 cur_state = self._check_params()  # re-check, they might have</span>
<span class="c1">## changed</span>
<span class="c1">## -&gt; 1051 cur_state = self._get_mst(X, cur_state)</span>
<span class="c1">##    1053 if cur_state[&quot;verbose&quot;]:</span>
<span class="c1">##    1054     print(&quot;[genieclust] Determining clusters with Genie++.&quot;,</span>
<span class="c1">## file=sys.stderr)</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:511, in GenieBase._get_mst(self, X,</span>
<span class="c1">## cur_state)</span>
<span class="c1">##     509     cur_state = self._get_mst_exact(X, cur_state)</span>
<span class="c1">##     510 else:</span>
<span class="c1">## --&gt; 511     cur_state = self._get_mst_approx(X, cur_state)</span>
<span class="c1">##     513 # this might be an &quot;intrinsic&quot; dimensionality:</span>
<span class="c1">##     514 self.n_features_  = cur_state[&quot;n_features&quot;]</span>
<span class="c1">## File ~/.virtualenvs/python3-default/lib/python3.11/site-</span>
<span class="c1">## packages/genieclust/genie.py:380, in GenieBase._get_mst_approx(self,</span>
<span class="c1">## X, cur_state)</span>
<span class="c1">##     378 def _get_mst_approx(self, X, cur_state):</span>
<span class="c1">##     379     if nmslib is None:</span>
<span class="c1">## --&gt; 380         raise ValueError(&quot;Package `nmslib` is not available.&quot;)</span>
<span class="c1">##     382     if cur_state[&quot;affinity&quot;] == &quot;precomputed&quot;:</span>
<span class="c1">##     383         raise ValueError(</span>
<span class="c1">##     384             &quot;`affinity` of &#39;precomputed&#39; can only be used &quot;</span>
<span class="c1">##     385             &quot;with `exact` = True.&quot;)</span>
<span class="c1">## ValueError: Package `nmslib` is not available.</span>
</pre></div>
</div>
<p>The above was performed on an abridged version of the MovieLens dataset.
The project’s <a class="reference external" href="https://grouplens.org/datasets/movielens/latest/">website</a>
also features a full database that yields a 53,889x283,228 ratings table
(with 27,753,444  non-zero elements) – such a matrix would definitely
not fit into our RAM if it was in the dense form.
Determining the whole cluster hierarchy takes only 144 seconds.
Here is one of 500 clusters extracted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## 13327                       Blackadder Back &amp; Forth (1999)</span>
<span class="c1">## 13328                  Blackadder&#39;s Christmas Carol (1988)</span>
<span class="c1">## 3341                              Creature Comforts (1989)</span>
<span class="c1">## 1197       Grand Day Out with Wallace and Gromit, A (1989)</span>
<span class="c1">## 2778                            Hard Day&#39;s Night, A (1964)</span>
<span class="c1">## 2861                                          Help! (1965)</span>
<span class="c1">## 2963                              How I Won the War (1967)</span>
<span class="c1">## 6006        Monty Python Live at the Hollywood Bowl (1982)</span>
<span class="c1">## 1113                Monty Python and the Holy Grail (1975)</span>
<span class="c1">## 2703     Monty Python&#39;s And Now for Something Completel...</span>
<span class="c1">## 1058                   Monty Python&#39;s Life of Brian (1979)</span>
<span class="c1">## 6698             Monty Python&#39;s The Meaning of Life (1983)</span>
<span class="c1">## 27284                                  Oliver Twist (1997)</span>
<span class="c1">## 2216                                 Producers, The (1968)</span>
<span class="c1">## 4716                                   Quadrophenia (1979)</span>
<span class="c1">## 6027             Secret Policeman&#39;s Other Ball, The (1982)</span>
<span class="c1">## 27448                                    The Basket (2000)</span>
<span class="c1">## 2792                                          Tommy (1975)</span>
<span class="c1">## 10475    Wallace &amp; Gromit in The Curse of the Were-Rabb...</span>
<span class="c1">## 732                 Wallace &amp; Gromit: A Close Shave (1995)</span>
<span class="c1">## 708      Wallace &amp; Gromit: The Best of Aardman Animatio...</span>
<span class="c1">## 1125           Wallace &amp; Gromit: The Wrong Trousers (1993)</span>
<span class="c1">## 13239    Wallace and Gromit in &#39;A Matter of Loaf and De...</span>
<span class="c1">## 2772                               Yellow Submarine (1968)</span>
<span class="c1">## 1250                             Young Frankenstein (1974)</span>
<span class="c1">## Name: title, dtype: object</span>
</pre></div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
              
              
              Copyright &#169; 2018–2023 by <a href="https://www.gagolewski.com">Marek Gagolewski</a>.
              Some rights reserved. Licensed under <a href='https://creativecommons.org/licenses/by-nc-nd/4.0/'>CC BY-NC-ND 4.0</a>.
              Built with <a href="https://sphinx-doc.org/">Sphinx</a>
              and a customised <a href="https://github.com/pradyunsg/furo">Furo</a> theme.
              Last updated on 2023-09-22T17:14:42+1000.
              This site will never display any ads: it is a non-profit project.
              It does not collect any data.
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=78ba0e71"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>